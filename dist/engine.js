(()=>{"use strict";class t{constructor(t,e,s){this.addElement=t=>{t.setContext(this.Context),this.Elements.push(t)},this.update=()=>{this.Context.clearRect(0,0,this.Width,this.Height),this.Elements.forEach((t=>{t.draw()}))},this.Name=t,this.Width=e,this.Height=s,this.Canvas=document.createElement("canvas"),this.Context=this.Canvas.getContext("2d"),this.Canvas.width=this.Width,this.Canvas.height=this.Height,this.Elements=[]}removeElement(t){this.Elements=this.Elements.filter((e=>e.Id!==("string"==typeof t?t:t.Id)))}}var e,s;!function(t){t.White="#fff",t.Black="#000",t.Red="#f00",t.Green="#0f0",t.Blue="#00f"}(e||(e={}));class i{}i.Integer=(t=0,e=1)=>Math.floor(i.Float(t,e)),i.Float=(t=0,e=1)=>Math.random()*(e-t)+t;class n{}n.New=()=>"xxxx-xxxx-xxxx-xxxx".replace(/x/g,(t=>"0123456789ABCDEF".charAt(i.Integer(0,16)))),function(t){t.Square="square",t.Circle="circle"}(s||(s={}));class h{constructor(t,e,i,h,a=h){this.setContext=t=>{this.ParentContext=t},this.setBackground=(t,e=1)=>{this.Background=t,this.Opacity=e},this.moveTo=(t,e,s=1)=>new Promise((i=>{const n=()=>{const h=Math.atan2(e-this.Y,t-this.X);this.X+=Math.round(10*(Math.cos(h)*s+Number.EPSILON))/10,this.Y+=Math.round(10*(Math.sin(h)*s+Number.EPSILON))/10,Math.abs(Math.floor(this.X)-t)<=s&&(this.X=t),Math.abs(Math.floor(this.Y)-e)<=s&&(this.Y=e),this.X===t&&this.Y===e?i():setTimeout((()=>{n()}),10)};n()})),this.draw=()=>{this.ParentContext&&(this.ParentContext.beginPath(),this.Background&&(this.ParentContext.fillStyle=this.Background),this.ParentContext.globalAlpha=this.Opacity,this.Type===s.Circle?this.ParentContext.arc(this.X,this.Y,this.Width,0,2*Math.PI):this.Type===s.Square&&this.ParentContext.fillRect(this.X,this.Y,this.Width,this.Height),this.ParentContext.fill(),this.ParentContext.closePath(),this.ParentContext.restore())},this.Id=n.New(),this.Type=t,this.X=e,this.Y=i,this.Width=h,this.Height=a,this.Opacity=1}}var a=function(t,e,s,i){return new(s||(s=Promise))((function(n,h){function a(t){try{r(i.next(t))}catch(t){h(t)}}function o(t){try{r(i.throw(t))}catch(t){h(t)}}function r(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,o)}r((i=i.apply(t,e||[])).next())}))};const o=new class{constructor(e,s,i){this.addLayer=e=>{if(this.getLayerByName(e))throw new Error(`У слоев должно быть уникальное имя. Имя '${e}' уже существует.`);const s=new t(e,this.Width,this.Height);return this.Layers.push(s),this.Target.appendChild(s.Canvas),s},this.getLayerByName=t=>this.Layers.find((e=>e.Name===t)),this.render=()=>{this.Layers.forEach((t=>{t.update()}))},this.run=()=>{this.render(),requestAnimationFrame(this.run)},this.Target=e,this.Width=s,this.Height=i,this.Layers=[]}}(document.body,800,600),r=o.addLayer("World");r.Canvas.style.cssText="border: 1px solid #000;";const c=new h(s.Circle,50,25,25);c.setBackground(e.Green,.25);const d=new h(s.Circle,25,25,25);d.setBackground(e.Red,.25),r.addElement(c),r.addElement(d);let l=[],u=0,f=[],x=0,m=(t,e)=>{d.moveTo(t.x,t.y,e).then((()=>{r.removeElement(t.dot),u++,l[u]?m(l[u],e):(l=[],u=0)}))},C=(t,e)=>{c.moveTo(t.x,t.y,e).then((()=>{r.removeElement(t.dot),x++,f[x]?C(f[x],e):(f=[],x=0)}))};r.Canvas.addEventListener("click",(t=>a(void 0,void 0,void 0,(function*(){const i=new h(s.Circle,t.offsetX,t.offsetY,5);i.setBackground(e.Red),l.push({x:t.offsetX,y:t.offsetY,dot:i}),r.addElement(i),1===l.length&&m(l[0],1)})))),r.Canvas.addEventListener("contextmenu",(t=>a(void 0,void 0,void 0,(function*(){t.preventDefault();const i=new h(s.Circle,t.offsetX,t.offsetY,5);i.setBackground(e.Green),f.push({x:t.offsetX,y:t.offsetY,dot:i}),r.addElement(i),1===f.length&&C(f[0],1)})))),o.run(),console.log(o)})();